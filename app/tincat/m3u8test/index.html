<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Tincat M3U8 Test</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0"/>

    <link href="../common/h5.css" rel="stylesheet"/>
    <style>
        .h5-button-play {
            background-color: #555555;
            color: #cacaca;
        }

        .h5-button-play:active {
            background-color: #333333;
        }
    </style>
    <script src="../common/h5.js"></script>
    <script src="../common/tincat.js"></script>
    <script src="../common/vue.min.js"></script>
</head>

<body style="background-color: #222222;">
<div id="app" style="position: absolute;left: 0px; top: 0px; right: 0px; bottom: 0px;width: 100%; height: 100%;display: flex; flex-direction: column;">
    <div>
        <video ref="video" controls style="width: 100%;"/>
    </div>
    <div style="padding: 8px 16px 16px 16px;display: flex; align-items: center;">
        <div style="flex-grow: 1;">
            <input v-model="url" class="h5-edittext-border" style="border-color: #555555;color: #9a9a9a;font-size: 14px;" placeholder="m3u8 url">
        </div>
        <div style="padding-left: 8px;">
            <button @click="play()" class="h5-button h5-button-play">Play</button>
        </div>
    </div>
    <div style="padding: 0px 0px 9px 16px;color: #9a9a9a;font-size: 14px;">Log Message</div>
    <div ref="logContainer" style="flex-grow: 1;overflow-y: auto;border: solid 1px #555555;margin: 0px 16px 16px 16px;border-radius: 4px;padding: 8px;line-height: 20px;"></div>
</div>
</body>

<script>
    new Vue({
        el: "#app",

        data: function()
        {
            return {
                url: ""
            };
        },

        mounted: function()
        {
            var that = this;

            this.video = this.$refs.video;
            this.video.onloadstart = function()
            {
                that.log("start loading video information...");
            };
            this.video.onloadedmetadata = function()
            {
                that.log("video metadata load success.");
            };
            this.video.onloadeddata = function()
            {
                that.log("video data load success.");
            };
            this.video.oncanplay = function()
            {
                that.log("video is ready to play...");
            };
            this.video.onplaying = function()
            {
                that.log("video is playing now...");
            };
            this.video.onpause = function()
            {
                that.log("video is paused.");
            };
            this.video.onended = function()
            {
                that.log("video is ended.");
            };
            this.video.onerror = function()
            {
                var msg = "unknown error!";
                switch(this.error.code)
                {
                    case 1:
                    {
                        msg = "aborted!";
                        break;
                    }
                    case 2:
                    {
                        msg = "network broken!";
                        break;
                    }
                    case 3:
                    {
                        msg = "unable to decode!";
                        break;
                    }
                    case 4:
                    {
                        msg = "type of video not support!";
                        break;
                    }
                }
                that.log(msg, true);
            };
            this.video.onabort = function()
            {
                that.log("video load abort.");
            };

            tincat.system.paste(function(text)
            {
                if(text && text.indexOf("http") === 0)
                {
                    that.url = text;
                    that.log("auto load url from system clipboard.");
                }
            });

            this.log("wait play...");
        },

        methods: {
            play: function()
            {
                if(!this.url)
                {
                    this.log("m3u8 url is null!");
                    return;
                }

                this.video.src = this.url;
                this.video.play();
            },

            log: function(msg, isError)
            {
                var time = h5.time.format(new Date(), "HH:mm:ss");
                var div = document.createElement("DIV");
                div.style.fontSize = "14px";
                if(isError)
                {
                    div.innerHTML = time + " ERROR " + msg;
                    div.style.color = "#d32f2f";
                }
                else
                {
                    div.innerHTML = time + " INFO " + msg;
                    div.style.color = "#4caf50";
                }
                this.$refs.logContainer.appendChild(div);
                this.$refs.logContainer.scrollTop = this.$refs.logContainer.scrollHeight;
            }
        }
    });
</script>
</html>