window.h5 = {
    /**
     * 工具类
     */
    util: {
        /**
         * 读取url参数
         * @param name
         */
        getParameter: function(name)
        {
            var param = {};
            if(location.search)
            {
                var kv = location.search.substring(1).split("&");
                for(var i = 0; i < kv.length; i++)
                {
                    var tmp = kv[i].split("=");
                    if(tmp.length == 2)
                    {
                        param[tmp[0]] = tmp[1];
                    }
                }
            }
            return param[name];
        }
    },

    /**
     * 自定义弹窗
     */
    dialog: {
        create: function(selector)
        {
            var dialog = {
                _selector: selector,

                showCenter: function()
                {
                    this._show("h5-dialog-center");
                },

                showLeft: function()
                {
                    this._show("h5-dialog-left");
                },

                showRight: function()
                {
                    this._show("h5-dialog-right");
                },

                showBottom: function()
                {
                    this._show("h5-dialog-bottom");
                },

                setOnDismissListener: function(onDismissListener)
                {
                    this._onDismissListener = onDismissListener;
                },

                dismiss: function()
                {
                    var that = this;
                    var mask = $(".h5-mask");
                    var dialog = $(this._selector);

                    dialog.css("animation", this._dialogClass + "-out 0.15s forwards ease-in");
                    mask.css("animation", "h5-mask-out 0.15s forwards ease-in");
                    setTimeout(function()
                    {
                        mask.remove();
                        dialog.attr("class", "");
                        dialog.css("animation", "");
                        dialog.hide();

                        $("body").css("overflow-y", "auto");

                        if(that._onDismissListener)
                        {
                            that._onDismissListener();
                            that._onDismissListener = null;
                        }
                    }, 200);
                },

                _show: function(dialogClass)
                {
                    var that = this;
                    this._dialogClass = dialogClass;

                    $("body").css("overflow-y", "hidden");

                    var maskDom = $("<div class=\"h5-mask\">&nbsp;</div>");
                    $("body").append(maskDom);

                    var dialogDom = $(this._selector);
                    dialogDom.attr("class", dialogClass);

                    setTimeout(function()
                    {
                        dialogDom.show();

                        setTimeout(function()
                        {
                            if("h5-dialog-center" === dialogClass)
                            {
                                dialogDom.bind("touchstart", function(e)
                                {
                                    if(e.target === dialogDom.get(0))
                                    {
                                        that.dismiss();
                                        return false;
                                    }
                                });
                            }
                            else
                            {
                                maskDom.bind("touchstart", function()
                                {
                                    that.dismiss();
                                    return false;
                                });
                            }
                        }, 200);
                    }, 100);
                }
            };
            return dialog;
        },

        list: function(items, onSelectListener)
        {
            var html =
                "<div style=\"width: 80%;border-radius: 16px;background-color: #ffffff;\">" +
                "<div style=\"padding: 16px;font-weight: bold\">Select</div>" +
                "<div id=\"body\" style=\"border-top: solid 1px #f7f7f7;border-bottom: solid 1px #f7f7f7;\">${items}</div>" +
                "<div id='close' style=\"padding: 16px;border-radius: 0px 0px 16px 16px;text-align: center;\" class=\"h5-selector\">Close</div>" +
                "</div>";
            var itemHtml = "";
            for(var i = 0; i < items.length; i++)
            {
                itemHtml += "<div class=\"h5-selector\" style=\"line-height: 50px;padding: 0px 16px 0px 16px;\">" + items[i] + "</div>";
            }
            html = html.replace("${items}", itemHtml);
            var dialogDom = document.createElement("DIV");
            dialogDom.setAttribute("id", "dialog_list");
            dialogDom.style.display = "none";
            dialogDom.innerHTML = html;
            document.body.appendChild(dialogDom);

            var dialog = this.create("#dialog_list");
            dialog.showCenter();

            dialogDom.querySelector("#close").addEventListener("click", function(e)
            {
                dialog.dismiss();
            });

            var itemDoms = dialogDom.querySelector("#body").childNodes;
            for(var i = 0; i < itemDoms.length; i++)
            {
                itemDoms[i].addEventListener("click", function(e)
                {
                    var button = this.innerHTML;
                    dialog.dismiss();
                    setTimeout(function()
                    {
                        onSelectListener(button);
                    }, 200);
                });
            }
        }
    }
}