<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Tincat TV</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0"/>

    <link rel="Shortcut Icon" href="drawable/icon.png" type="image/png"/>
    <link href="../common/h5.css" rel="stylesheet"/>

    <script src="libs/context.js"></script>
    <script src="../common/h5.js"></script>
    <script src="../common/tincat.js"></script>
    <script src="../common/vue.min.js"></script>
    <script src="../common/vue-form.min.js"></script>
</head>

<body style="background-color: #f6f6f6;">
<div id="app">
    <div class="h5-actionbar">
        <img @click="history.back()" src="drawable/icon_back.svg"/>
        <div>Add Your TV Channel</div>
    </div>

    <div style="padding-top: 50px;">
        <div style="font-weight: bold; padding: 16px 0px 8px 16px;">M3U8 Channel</div>
        <div style="padding: 16px; background-color: #ffffff;border-radius: 24px;">
            <vue-form :state="formstate" v-model="formstate" @submit.prevent="onSubmit()">
                <validate>
                    <div>Channel Title</div>
                    <div>
                        <input class="h5-edittext" type="text" v-model="formdata.channelName" name="channelName" placeholder="channel title" required/>
                    </div>
                </validate>
                <validate>
                    <div style="margin-top: 32px;">TV Live Source</div>
                    <div>
                        <input class="h5-edittext" type="text" v-model="formdata.url" name="url" placeholder="m3u8 url" required/>
                    </div>
                </validate>
                <div style="margin-top: 32px;text-align: center;">
                    <button :disabled="formstate.$invalid" type="submit" class="h5-button-round h5-button-blue" style="width: 250px;">Save To Favorite</button>
                </div>
            </vue-form>
        </div>

        <div style="font-weight: bold; padding: 32px 0px 8px 16px;">M3U Channel List</div>
        <div style="padding: 16px; background-color: #ffffff;border-radius: 24px;">
            <div>
                <input v-model="m3uUrl" class="h5-edittext" type="text" placeholder="m3u url" required/>
            </div>
            <div style="margin-top: 32px;text-align: center;">
                <button @click="showM3U()" class="h5-button-round h5-button-blue" style="width: 250px;;">Show M3U Channel List</button>
            </div>
        </div>
    </div>
</div>
</body>

<script>
    Vue.use(VueForm, {validators: {}});

    new Vue({
        el: "#app",

        data: function()
        {
            return {
                formdata: {},
                formstate: {},
                m3uUrl: null
            };
        },

        methods: {
            onSubmit: function()
            {
                var that = this;
                Channel.addChannels([that.formdata]);
            },

            showM3U: function()
            {
                if(!this.m3uUrl)
                {
                    alert("m3u url is null");
                    return;
                }

                var that = this;
                tincat.http.get({
                    url: this.url,
                    mask: true,
                    callback: function(result)
                    {
                        h5.storage.set("temp", result, function()
                        {
                            location.href = "channels.html";
                        });
                    },
                    failCallback: function()
                    {
                        toast("network error");
                    }
                });
            }
        }
    });
</script>
</html>